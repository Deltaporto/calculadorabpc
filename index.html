<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora Biopsicossocial ‚Äî BPC/LOAS</title>
  <meta name="description" content="Calculadora interativa para avalia√ß√£o biopsicossocial do BPC">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Source+Sans+3:wght@300;400;600;700&display=swap"
    rel="stylesheet">
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0
    }

    :root {
      --bg: #F0F2F7;
      --surface: #FFF;
      --text: #0F1B2D;
      --text2: #4B5563;
      --text3: #9CA3AF;
      --border: #E5E7EB;
      --navy: #0F1B2D;
      --gold: #C5A55A;
      --blue: #2563EB;
      --qN: #9CA3AF;
      --qL: #60A5FA;
      --qM: #FBBF24;
      --qG: #FB923C;
      --qC: #EF4444;
      --yes: #059669;
      --no: #DC2626;
      --radius: 12px;
      --shadow: 0 1px 3px rgba(0, 0, 0, .08), 0 1px 2px rgba(0, 0, 0, .04);
      --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, .1);
    }

    [data-theme="dark"] {
      --bg: #0A0F1A;
      --surface: #141B2D;
      --text: #F1F5F9;
      --text2: #94A3B8;
      --text3: #64748B;
      --border: #1E293B;
      --shadow: 0 1px 3px rgba(0, 0, 0, .3);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, .4);
    }

    html {
      font-size: 15px
    }

    body {
      font-family: 'Source Sans 3', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh
    }

    h1,
    h2,
    h3 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700
    }

    .app {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 16px 40px
    }

    /* HEADER */
    header {
      background: var(--navy);
      color: #fff;
      padding: 24px 32px;
      border-radius: 0 0 20px 20px;
      margin: 0 -16px 20px;
      text-align: center
    }

    header h1 {
      font-size: 1.8rem;
      letter-spacing: -.02em;
      margin-bottom: 4px
    }

    header .badge {
      display: inline-block;
      background: var(--gold);
      color: var(--navy);
      font-size: .7rem;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 20px;
      margin-bottom: 8px;
      letter-spacing: .05em;
      text-transform: uppercase
    }

    header p {
      color: rgba(255, 255, 255, .65);
      font-size: .85rem
    }

    .header-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      margin-top: 12px;
      flex-wrap: wrap
    }

    .header-row label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: .8rem;
      color: rgba(255, 255, 255, .7);
      cursor: pointer;
      user-select: none
    }

    .header-row input[type=checkbox] {
      accent-color: var(--gold);
      width: 16px;
      height: 16px
    }

    /* TOOLBAR */
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
      align-items: center
    }

    .btn {
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: .85rem;
      border: none;
      border-radius: 8px;
      padding: 10px 18px;
      cursor: pointer;
      transition: all .2s;
      display: inline-flex;
      align-items: center;
      gap: 6px
    }

    .btn-gold {
      background: linear-gradient(135deg, #C5A55A, #D4B96A);
      color: #1a1a1a;
      box-shadow: 0 2px 8px rgba(197, 165, 90, .3)
    }

    .btn-gold:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(197, 165, 90, .4)
    }

    .btn-outline {
      background: var(--surface);
      color: var(--text);
      border: 1.5px solid var(--border)
    }

    .btn-outline:hover {
      border-color: var(--text3)
    }

    .btn-red {
      background: #FEE2E2;
      color: #991B1B;
      border: 1.5px solid #FECACA
    }

    .idade-input {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: .85rem;
      color: var(--text2)
    }

    .idade-input input {
      width: 60px;
      padding: 6px 8px;
      border: 1.5px solid var(--border);
      border-radius: 6px;
      font-size: .85rem;
      background: var(--surface);
      color: var(--text);
      text-align: center
    }

    .hidden {
      display: none !important
    }

    /* PANELS */
    .calculator {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      margin-bottom: 20px
    }

    @media(max-width:1024px) {
      .calculator {
        grid-template-columns: 1fr
      }
    }

    .panel {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      display: flex;
      flex-direction: column
    }

    .panel-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, color-mix(in srgb, var(--panel-color) 6%, var(--surface)), var(--surface))
    }

    .panel-icon {
      font-size: 1.6rem
    }

    .panel-header h2 {
      font-size: 1rem;
      color: var(--text)
    }

    .panel-header .sub {
      font-size: .75rem;
      color: var(--text3);
      margin-top: 1px
    }

    .domains {
      padding: 12px 16px;
      flex: 1
    }

    /* DOMAIN ROW */
    .domain-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid color-mix(in srgb, var(--border) 50%, transparent)
    }

    .domain-row:last-child {
      border-bottom: none
    }

    .domain-label {
      flex: 1;
      min-width: 0
    }

    .domain-code {
      display: inline-block;
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: .75rem;
      color: var(--text3);
      width: 22px
    }

    .domain-name {
      font-size: .8rem;
      color: var(--text2)
    }

    .note-buttons {
      display: flex;
      gap: 3px;
      flex-shrink: 0
    }

    .note-btn {
      width: 34px;
      height: 34px;
      border-radius: 7px;
      border: 1.5px solid var(--border);
      background: var(--surface);
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: .8rem;
      color: var(--text3);
      cursor: pointer;
      transition: all .15s;
      position: relative
    }

    .note-btn:hover {
      border-color: var(--text3);
      transform: scale(1.05)
    }

    .note-btn.active[data-value="0"] {
      background: var(--qN);
      color: #fff;
      border-color: var(--qN)
    }

    .note-btn.active[data-value="1"] {
      background: var(--qL);
      color: #fff;
      border-color: var(--qL)
    }

    .note-btn.active[data-value="2"] {
      background: var(--qM);
      color: #1a1a1a;
      border-color: var(--qM)
    }

    .note-btn.active[data-value="3"] {
      background: var(--qG);
      color: #fff;
      border-color: var(--qG)
    }

    .note-btn.active[data-value="4"] {
      background: var(--qC);
      color: #fff;
      border-color: var(--qC)
    }

    .note-btn.locked {
      opacity: .7;
      cursor: not-allowed;
      pointer-events: none
    }

    .note-btn.locked.active {
      opacity: 1
    }

    .section-label {
      font-size: .7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .08em;
      padding: 8px 0 4px;
      display: flex;
      align-items: center;
      gap: 6px
    }

    .badge-m {
      background: #EFF6FF;
      color: #1D4ED8;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: .65rem
    }

    .badge-s {
      background: #F0FDF4;
      color: #166534;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: .65rem
    }

    /* PANEL RESULT */
    .panel-result {
      padding: 12px 16px;
      border-top: 1px solid var(--border);
      background: color-mix(in srgb, var(--bg) 50%, var(--surface))
    }

    .formula {
      font-size: .78rem;
      color: var(--text3);
      margin-bottom: 8px;
      font-variant-numeric: tabular-nums
    }

    .formula .val {
      font-weight: 700;
      color: var(--text)
    }

    .result-bar {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 8px
    }

    .result-fill {
      height: 100%;
      border-radius: 4px;
      transition: width .4s ease, background .3s
    }

    .panel-result-row {
      display: flex;
      align-items: center;
      justify-content: space-between
    }

    .qualifier-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 42px;
      height: 42px;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 1.2rem;
      color: #fff;
      transition: all .3s
    }

    .qualifier-badge[data-q="N"] {
      background: var(--qN)
    }

    .qualifier-badge[data-q="L"] {
      background: var(--qL)
    }

    .qualifier-badge[data-q="M"] {
      background: var(--qM);
      color: #1a1a1a
    }

    .qualifier-badge[data-q="G"] {
      background: var(--qG)
    }

    .qualifier-badge[data-q="C"] {
      background: var(--qC)
    }

    .qualifier-badge.large {
      width: 56px;
      height: 56px;
      font-size: 1.5rem;
      border-radius: 14px
    }

    .qual-name {
      font-size: .75rem;
      color: var(--text3);
      margin-top: 2px
    }

    .majoracao-toggles {
      padding: 8px 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      border-top: 1px solid var(--border)
    }

    .toggle-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: .8rem;
      color: var(--text2);
      cursor: pointer;
      user-select: none
    }

    .toggle-switch {
      position: relative;
      width: 36px;
      height: 20px;
      background: var(--border);
      border-radius: 10px;
      transition: .3s;
      flex-shrink: 0
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: .3s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, .2)
    }

    input:checked+.toggle-switch {
      background: var(--blue)
    }

    input:checked+.toggle-switch::after {
      left: 18px
    }

    .toggle-label input[type=checkbox] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0
    }

    /* RESULTADO */
    .resultado {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      padding: 24px;
      margin-bottom: 20px
    }

    .resultado>h2 {
      text-align: center;
      font-size: 1.1rem;
      margin-bottom: 20px;
      color: var(--text2)
    }

    .qualifiers-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 24px
    }

    .qual-card {
      text-align: center;
      padding: 12px 20px;
      border-radius: 12px;
      background: var(--bg);
      min-width: 140px
    }

    .qual-label {
      display: block;
      font-size: .7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .05em;
      color: var(--text3);
      margin-bottom: 8px
    }

    .qual-desc {
      display: block;
      font-size: .72rem;
      color: var(--text3);
      margin-top: 4px
    }

    .qual-sep {
      font-size: 1.5rem;
      color: var(--text3);
      font-weight: 300
    }

    /* TABELA CONCLUSIVA */
    .tabela-section {
      margin-bottom: 24px
    }

    .tabela-section h3 {
      font-size: .9rem;
      text-align: center;
      margin-bottom: 12px;
      color: var(--text2)
    }

    .amb-tabs {
      display: flex;
      justify-content: center;
      gap: 4px;
      margin-bottom: 12px
    }

    .amb-tab-label {
      font-size: .75rem;
      color: var(--text3);
      align-self: center;
      margin-right: 8px
    }

    .amb-tab {
      width: 36px;
      height: 30px;
      border-radius: 6px;
      border: 1.5px solid var(--border);
      background: var(--surface);
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: .8rem;
      color: var(--text3);
      cursor: pointer;
      transition: all .15s
    }

    .amb-tab.active {
      background: var(--navy);
      color: #fff;
      border-color: var(--navy)
    }

    [data-theme="dark"] .amb-tab.active {
      background: var(--gold);
      color: #1a1a1a;
      border-color: var(--gold)
    }

    .tabela-grid {
      display: grid;
      grid-template-columns: auto repeat(5, 1fr);
      gap: 3px;
      max-width: 500px;
      margin: 0 auto
    }

    .tc {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 44px;
      border-radius: 6px;
      font-family: 'DM Sans', sans-serif;
      font-weight: 600;
      font-size: .75rem;
      transition: all .3s
    }

    .tc.header {
      background: transparent;
      color: var(--text3);
      font-size: .7rem
    }

    .tc.corner {
      background: transparent
    }

    .tc.row-header {
      background: transparent;
      color: var(--text3);
      font-size: .7rem;
      justify-content: flex-end;
      padding-right: 8px
    }

    .tc.yes {
      background: #D1FAE5;
      color: #065F46
    }

    .tc.no {
      background: #FEE2E2;
      color: #991B1B
    }

    [data-theme="dark"] .tc.yes {
      background: #064E3B;
      color: #6EE7B7
    }

    [data-theme="dark"] .tc.no {
      background: #450A0A;
      color: #FCA5A5
    }

    .tc.active-cell {
      outline: 3px solid var(--navy);
      outline-offset: -1px;
      animation: pulse-cell 1.5s ease infinite;
      z-index: 1;
      font-weight: 700;
      font-size: .8rem
    }

    [data-theme="dark"] .tc.active-cell {
      outline-color: var(--gold)
    }

    @keyframes pulse-cell {

      0%,
      100% {
        outline-offset: -1px
      }

      50% {
        outline-offset: 2px
      }
    }

    .tabela-labels {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px
    }

    .tabela-labels span {
      font-size: .7rem;
      color: var(--text3);
      display: flex;
      align-items: center;
      gap: 4px
    }

    .dot {
      width: 10px;
      height: 10px;
      border-radius: 3px;
      display: inline-block
    }

    .dot.g {
      background: #D1FAE5;
      border: 1px solid #065F46
    }

    .dot.r {
      background: #FEE2E2;
      border: 1px solid #991B1B
    }

    .tabela-axis-label {
      text-align: center;
      font-size: .7rem;
      color: var(--text3);
      font-weight: 600
    }

    /* DECISION BANNER */
    .decision {
      text-align: center;
      padding: 20px;
      border-radius: 14px;
      transition: all .4s
    }

    .decision.deferido {
      background: linear-gradient(135deg, #D1FAE5, #A7F3D0);
      border: 2px solid #059669
    }

    .decision.indeferido {
      background: linear-gradient(135deg, #FEE2E2, #FECACA);
      border: 2px solid #DC2626
    }

    .decision.impedimento {
      background: linear-gradient(135deg, #FEF3C7, #FDE68A);
      border: 2px solid #D97706
    }

    [data-theme="dark"] .decision.deferido {
      background: linear-gradient(135deg, #064E3B, #065F46);
      border-color: #10B981
    }

    [data-theme="dark"] .decision.indeferido {
      background: linear-gradient(135deg, #450A0A, #7F1D1D);
      border-color: #F87171
    }

    [data-theme="dark"] .decision.impedimento {
      background: linear-gradient(135deg, #451A03, #78350F);
      border-color: #FBBF24
    }

    .decision-icon {
      font-size: 2.2rem;
      margin-bottom: 4px
    }

    .decision-label {
      font-family: 'DM Sans', sans-serif;
      font-size: 1.4rem;
      font-weight: 700
    }

    .decision.deferido .decision-label {
      color: #065F46
    }

    .decision.indeferido .decision-label {
      color: #991B1B
    }

    .decision.impedimento .decision-label {
      color: #92400E
    }

    [data-theme="dark"] .decision.deferido .decision-label {
      color: #6EE7B7
    }

    [data-theme="dark"] .decision.indeferido .decision-label {
      color: #FCA5A5
    }

    [data-theme="dark"] .decision.impedimento .decision-label {
      color: #FCD34D
    }

    .decision-reason {
      display: block;
      font-size: .8rem;
      color: var(--text2);
      margin-top: 4px
    }

    .decision-item {
      font-size: .75rem;
      color: var(--text3);
      margin-top: 2px
    }

    /* COMPARISON */
    .comparison {
      background: var(--surface);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
      margin-bottom: 20px
    }

    .comparison h3 {
      font-size: .95rem;
      margin-bottom: 16px;
      text-align: center;
      color: var(--text2)
    }

    .comp-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px
    }

    @media(max-width:600px) {
      .comp-grid {
        grid-template-columns: 1fr
      }
    }

    .comp-card {
      padding: 16px;
      border-radius: 10px;
      text-align: center
    }

    .comp-card.inss {
      background: #FEF3C7;
      border: 1.5px solid #F59E0B
    }

    .comp-card.pericia {
      background: #DBEAFE;
      border: 1.5px solid #3B82F6
    }

    [data-theme="dark"] .comp-card.inss {
      background: #451A03;
      border-color: #F59E0B
    }

    [data-theme="dark"] .comp-card.pericia {
      background: #1E2A4A;
      border-color: #3B82F6
    }

    .comp-title {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: .85rem;
      margin-bottom: 8px
    }

    .comp-quals {
      font-size: .8rem;
      color: var(--text2);
      margin-bottom: 8px
    }

    .comp-result {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 1rem
    }

    .comp-result.yes {
      color: var(--yes)
    }

    .comp-result.no {
      color: var(--no)
    }

    .comp-change {
      margin-top: 8px;
      font-size: .75rem;
      color: var(--text3)
    }

    /* FOOTER */
    .footer-actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap
    }

    footer {
      text-align: center;
      padding: 20px;
      color: var(--text3);
      font-size: .75rem
    }

    footer p {
      margin-bottom: 4px
    }

    /* ANIMATION */
    @keyframes pop {
      0% {
        transform: scale(1)
      }

      50% {
        transform: scale(1.08)
      }

      100% {
        transform: scale(1)
      }
    }

    .pop {
      animation: pop .3s ease
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <span class="badge">‚öñÔ∏è BPC / LOAS</span>
      <h1>Calculadora Biopsicossocial</h1>
      <p>Portaria Conjunta MDS/INSS n¬∫ 2/2015 ¬∑ Tabela Conclusiva (Anexo IV)</p>
      <div class="header-row">
        <label><input type="checkbox" id="toggleDark"> üåô Modo escuro</label>
        <span class="idade-input" id="idadeWrap">Idade: <input type="number" id="inputIdade" min="0" max="216"
            value="24"> meses ¬∑ <strong id="faixaEtaria">Menor de 16 anos</strong></span>
      </div>
    </header>

    <div class="toolbar">
      <button class="btn btn-gold" id="btnPadrao">üìä Aplicar Padr√£o M√©dio Social</button>
      <button class="btn btn-outline" id="btnLimpar">üóëÔ∏è Limpar</button>
      <label class="toggle-label">
        <input type="checkbox" id="toggleImpedimento"><span class="toggle-switch"></span>
        ‚ö†Ô∏è Impedimento &lt; 2 anos
      </label>
    </div>

    <main class="calculator">
      <!-- Panel Ambiente -->
      <section class="panel" style="--panel-color:#2563EB">
        <div class="panel-header">
          <div class="panel-icon">üè†</div>
          <div>
            <h2>Fatores Ambientais</h2>
            <div class="sub">Avalia√ß√£o Social ¬∑ 5 dom√≠nios (e1‚Äìe5)</div>
          </div>
        </div>
        <div class="domains" id="domAmb"></div>
        <div class="panel-result">
          <div class="formula" id="fAmb"></div>
          <div class="result-bar">
            <div class="result-fill" id="barAmb"></div>
          </div>
          <div class="panel-result-row"><span class="qual-name" id="nameAmb">Nenhuma Barreira</span>
            <div class="qualifier-badge" id="qAmb" data-q="N">N</div>
          </div>
        </div>
      </section>
      <!-- Panel Corpo -->
      <section class="panel" style="--panel-color:#DC2626">
        <div class="panel-header">
          <div class="panel-icon">ü©∫</div>
          <div>
            <h2>Fun√ß√µes do Corpo</h2>
            <div class="sub">Avalia√ß√£o M√©dica ¬∑ 8 dom√≠nios (b1‚Äìb8)</div>
          </div>
        </div>
        <div class="domains" id="domCorpo"></div>
        <div class="majoracao-toggles">
          <label class="toggle-label"><input type="checkbox" id="toggleProg"><span
              class="toggle-switch"></span>Progn√≥stico desfavor√°vel</label>
          <label class="toggle-label"><input type="checkbox" id="toggleEstr"><span
              class="toggle-switch"></span>Estrutura do Corpo &gt; Fun√ß√£o</label>
        </div>
        <div class="panel-result">
          <div class="formula" id="fCorpo"></div>
          <div class="panel-result-row"><span class="qual-name" id="nameCorpo">Nenhuma Altera√ß√£o</span>
            <div class="qualifier-badge" id="qCorpo" data-q="N">N</div>
          </div>
        </div>
      </section>
      <!-- Panel Atividades -->
      <section class="panel" style="--panel-color:#7C3AED">
        <div class="panel-header">
          <div class="panel-icon">ü§ù</div>
          <div>
            <h2>Atividades e Participa√ß√£o</h2>
            <div class="sub">Misto ¬∑ 9 dom√≠nios (d1‚Äìd9)</div>
          </div>
        </div>
        <div class="domains">
          <div class="section-label"><span class="badge-m">Perito M√©dico</span> d1‚Äìd5</div>
          <div id="domAtivM"></div>
          <div class="section-label"><span class="badge-s">Assistente Social</span> d6‚Äìd9</div>
          <div id="domAtivS"></div>
        </div>
        <div class="panel-result">
          <div class="formula" id="fAtiv"></div>
          <div class="result-bar">
            <div class="result-fill" id="barAtiv"></div>
          </div>
          <div class="panel-result-row"><span class="qual-name" id="nameAtiv">Nenhuma Dificuldade</span>
            <div class="qualifier-badge" id="qAtiv" data-q="N">N</div>
          </div>
        </div>
      </section>
    </main>

    <section class="resultado" id="resultado">
      <h2>Resultado da Avalia√ß√£o</h2>
      <div class="qualifiers-row">
        <div class="qual-card"><span class="qual-label">Fatores Ambientais</span>
          <div class="qualifier-badge large" id="rAmb" data-q="N">N</div><span class="qual-desc"
            id="dAmb">Nenhuma</span>
        </div>
        <span class="qual-sep">√ó</span>
        <div class="qual-card"><span class="qual-label">Atividades e Participa√ß√£o</span>
          <div class="qualifier-badge large" id="rAtiv" data-q="N">N</div><span class="qual-desc"
            id="dAtiv">Nenhuma</span>
        </div>
        <span class="qual-sep">√ó</span>
        <div class="qual-card"><span class="qual-label">Fun√ß√µes do Corpo</span>
          <div class="qualifier-badge large" id="rCorpo" data-q="N">N</div><span class="qual-desc"
            id="dCorpo">Nenhuma</span>
        </div>
      </div>
      <div class="tabela-section">
        <h3>Tabela Conclusiva ‚Äî Anexo IV, Portaria 2/2015</h3>
        <div class="amb-tabs"><span class="amb-tab-label">Ambiente:</span><button class="amb-tab active"
            data-a="0">N</button><button class="amb-tab" data-a="1">L</button><button class="amb-tab"
            data-a="2">M</button><button class="amb-tab" data-a="3">G</button><button class="amb-tab"
            data-a="4">C</button></div>
        <div class="tabela-axis-label">‚Üì Fun√ß√µes do Corpo √ó Atividades e Participa√ß√£o ‚Üí</div>
        <div class="tabela-grid" id="tGrid"></div>
        <div class="tabela-labels"><span><span class="dot g"></span> Deferido (Sim)</span><span><span
              class="dot r"></span> Indeferido (N√£o)</span></div>
      </div>
      <div class="decision indeferido" id="decision">
        <div class="decision-icon" id="decIcon">‚Äî</div>
        <div class="decision-label" id="decLabel">AGUARDANDO DADOS</div>
        <span class="decision-reason" id="decReason">Insira as notas nos dom√≠nios acima</span>
        <span class="decision-item" id="decItem"></span>
      </div>
    </section>

    <div class="footer-actions">
      <button class="btn btn-outline" id="btnSaveINSS">üì∏ Salvar</button>
      <button class="btn btn-red hidden" id="btnClearComp">‚úï Limpar compara√ß√£o</button>
    </div>
    <div class="comparison hidden" id="compSection">
      <h3>Compara√ß√£o: Avalia√ß√£o INSS √ó Reclassifica√ß√£o Judicial</h3>
      <div class="comp-grid">
        <div class="comp-card inss">
          <div class="comp-title">Avalia√ß√£o INSS</div>
          <div class="comp-quals" id="compINSSq"></div>
          <div class="comp-result" id="compINSSr"></div>
        </div>
        <div class="comp-card pericia">
          <div class="comp-title">Reclassifica√ß√£o Judicial</div>
          <div class="comp-quals" id="compPERq"></div>
          <div class="comp-result" id="compPERr"></div>
        </div>
      </div>
      <div class="comp-change" id="compChange"></div>
    </div>

    <footer>
      <p>Base normativa: Portaria Conjunta MDS/INSS n¬∫ 2/2015 (Anexo IV) ¬∑ Portaria MDS/INSS n¬∫ 34/2025 (Art. 13, ¬ß7¬∫)
      </p>
      <p>Resolu√ß√£o CNJ n¬∫ 630/2025 (Sisperjud) ¬∑ 2¬™ Turma Recursal ‚Äî SJRJ | Gabinete 3</p>
    </footer>
  </div>

  <script>
    // ============ DOMAIN DEFINITIONS ============
    const Q_LABELS = ['N', 'L', 'M', 'G', 'C'];
    const Q_NAMES = ['Nenhuma', 'Leve', 'Moderada', 'Grave', 'Completa'];
    const Q_FULL = {
      amb: ['Nenhuma Barreira', 'Barreira Leve', 'Barreira Moderada', 'Barreira Grave', 'Barreira Completa'],
      corpo: ['Nenhuma Altera√ß√£o', 'Altera√ß√£o Leve', 'Altera√ß√£o Moderada', 'Altera√ß√£o Grave', 'Altera√ß√£o Completa'],
      ativ: ['Nenhuma Dificuldade', 'Dificuldade Leve', 'Dificuldade Moderada', 'Dificuldade Grave', 'Dificuldade Completa']
    };

    const DOM_AMB = [
      { id: 'e1', name: 'Produtos e Tecnologia' }, { id: 'e2', name: 'Condi√ß√µes de Habitabilidade' },
      { id: 'e3', name: 'Apoio e Relacionamentos' }, { id: 'e4', name: 'Atitudes' },
      { id: 'e5', name: 'Servi√ßos, Sistemas e Pol√≠ticas' }
    ];
    const DOM_CORPO = [
      { id: 'b1', name: 'Fun√ß√µes Mentais' }, { id: 'b2', name: 'Vis√£o' }, { id: 'b3', name: 'Audi√ß√£o' },
      { id: 'b4', name: 'Dor e Sensa√ß√µes' }, { id: 'b5', name: 'Voz e Fala' },
      { id: 'b6', name: 'Cardiovascular / Respirat√≥rio' }, { id: 'b7', name: 'Digestivo / Metab√≥lico' },
      { id: 'b8', name: 'Neuromusculoesquel√©tico' }
    ];
    const DOM_ATIV_M = [
      { id: 'd1', name: 'Aprendizagem', cut: 6 }, { id: 'd2', name: 'Tarefas Gerais', cut: 6 },
      { id: 'd3', name: 'Comunica√ß√£o', cut: 12 }, { id: 'd4', name: 'Mobilidade', cut: 6 },
      { id: 'd5', name: 'Cuidado Pessoal', cut: 36 }
    ];
    const DOM_ATIV_S = [
      { id: 'd6', name: 'Vida Dom√©stica', cut: 84 }, { id: 'd7', name: 'Rela√ß√µes Interpessoais', cut: 12 },
      { id: 'd8', name: '√Åreas Principais da Vida', cut: 6 }, { id: 'd9', name: 'Vida Comunit√°ria', cut: 36 }
    ];

    // ============ STATE ============
    const state = {};
    [...DOM_AMB, ...DOM_CORPO, ...DOM_ATIV_M, ...DOM_ATIV_S].forEach(d => state[d.id] = 0);
    const CHILD_AGE_LIMIT_MONTHS = 192;
    let progDesfav = false, estrMaior = false, impedimento = false, crianca = true, idadeMeses = 24;
    let savedINSS = null;
    let currentAmbTab = 0;
    const childDomainBackup = {};

    // ============ CALCULATION ============
    function pctToQ(pct) {
      if (pct < 0) pct = 0;
      if (pct <= 4) return 0; if (pct <= 24) return 1; if (pct <= 49) return 2; if (pct <= 95) return 3; return 4;
    }
    function calcAmbiente() {
      const s = DOM_AMB.reduce((a, d) => a + state[d.id], 0);
      const pct = Math.max(0, (s * 5) - 0.1);
      return { sum: s, pct: +pct.toFixed(1), q: pctToQ(pct) };
    }
    function calcAtividades() {
      const s = [...DOM_ATIV_M, ...DOM_ATIV_S].reduce((a, d) => a + state[d.id], 0);
      const pct = Math.max(0, (s * 2.77777777777778) - 0.1);
      return { sum: s, pct: +pct.toFixed(1), q: pctToQ(pct) };
    }
    function calcCorpo() {
      let mx = DOM_CORPO.reduce((a, d) => Math.max(a, state[d.id]), 0);
      const base = mx;
      if ((progDesfav || estrMaior) && mx < 4) mx++;
      return { max: base, final: mx, majorado: mx > base, q: mx };
    }
    function tabelaConclusiva(amb, ativ, corpo) {
      if (corpo <= 1) return false;
      if (ativ <= 1) return false;
      if (corpo >= 3) return true;
      if (ativ >= 3) return true;
      return amb >= 3;
    }
    function getItemNumber(amb, ativ, corpo) {
      // Items ordered: corpo C‚ÜíN, for each corpo: ativ C‚ÜíN, for each ativ: amb C‚ÜíN
      const corpoOrder = [4, 3, 2, 1, 0], ativOrder = [4, 3, 2, 1, 0], ambOrder = [4, 3, 2, 1, 0];
      let n = 0;
      for (const c of corpoOrder) for (const a of ativOrder) for (const e of ambOrder) {
        n++; if (c === corpo && a === ativ && e === amb) return n;
      }
      return n;
    }

    // ============ DOM BUILDERS ============
    function buildDomainRows(container, domains) {
      domains.forEach(d => {
        const row = document.createElement('div');
        row.className = 'domain-row';
        row.innerHTML = `<div class="domain-label"><span class="domain-code">${d.id}</span> <span class="domain-name">${d.name}</span></div>
      <div class="note-buttons" data-domain="${d.id}">${[0, 1, 2, 3, 4].map(v => `<button class="note-btn${v === 0 ? ' active' : ''}" data-value="${v}">${v}</button>`).join('')}</div>`;
        container.appendChild(row);
      });
    }
    function buildTabelaGrid() {
      const g = document.getElementById('tGrid');
      g.innerHTML = '';
      // Corner
      g.innerHTML += '<div class="tc corner"></div>';
      // Header row (Atividades)
      Q_LABELS.forEach(l => g.innerHTML += `<div class="tc header">${l}</div>`);
      // Rows (Corpo)
      for (let c = 0; c < 5; c++) {
        g.innerHTML += `<div class="tc row-header">${Q_LABELS[c]}</div>`;
        for (let a = 0; a < 5; a++) {
          const yes = tabelaConclusiva(currentAmbTab, a, c);
          g.innerHTML += `<div class="tc ${yes ? 'yes' : 'no'}" data-c="${c}" data-a="${a}">${yes ? 'Sim' : 'N√£o'}</div>`;
        }
      }
    }

    // ============ UI UPDATE ============
    function update() {
      const amb = calcAmbiente(), ativ = calcAtividades(), corpo = calcCorpo();
      // Panel Ambiente
      document.getElementById('fAmb').innerHTML = `(<span class="val">${amb.sum}</span> √ó 5) ‚àí 0,1 = <span class="val">${amb.pct}%</span>`;
      const barA = document.getElementById('barAmb');
      barA.style.width = Math.min(100, amb.pct) + '%';
      barA.style.background = `var(--q${Q_LABELS[amb.q]})`;
      setQBadge('qAmb', amb.q);
      document.getElementById('nameAmb').textContent = Q_FULL.amb[amb.q];

      // Panel Corpo
      const mInfo = corpo.majorado ? ` ‚Üí <span class="val">${corpo.final}</span> (majora√ß√£o +1)` : '';
      document.getElementById('fCorpo').innerHTML = `M√°ximo dos dom√≠nios: <span class="val">${corpo.max}</span>${mInfo}`;
      setQBadge('qCorpo', corpo.q);
      document.getElementById('nameCorpo').textContent = Q_FULL.corpo[corpo.q];

      // Panel Atividades
      document.getElementById('fAtiv').innerHTML = `(<span class="val">${ativ.sum}</span> √ó 2,778) ‚àí 0,1 = <span class="val">${ativ.pct}%</span>`;
      const barB = document.getElementById('barAtiv');
      barB.style.width = Math.min(100, ativ.pct) + '%';
      barB.style.background = `var(--q${Q_LABELS[ativ.q]})`;
      setQBadge('qAtiv', ativ.q);
      document.getElementById('nameAtiv').textContent = Q_FULL.ativ[ativ.q];

      // Result qualifiers
      setQBadge('rAmb', amb.q); setQBadge('rAtiv', ativ.q); setQBadge('rCorpo', corpo.q);
      document.getElementById('dAmb').textContent = Q_NAMES[amb.q];
      document.getElementById('dAtiv').textContent = Q_NAMES[ativ.q];
      document.getElementById('dCorpo').textContent = Q_NAMES[corpo.q];

      // Auto-select amb tab
      currentAmbTab = amb.q;
      document.querySelectorAll('.amb-tab').forEach(t => { t.classList.toggle('active', +t.dataset.a === amb.q) });
      buildTabelaGrid();
      highlightActiveCell(ativ.q, corpo.q);

      // Decision
      const dec = document.getElementById('decision');
      const item = getItemNumber(amb.q, ativ.q, corpo.q);
      if (impedimento) {
        dec.className = 'decision impedimento';
        document.getElementById('decIcon').textContent = '‚ö†Ô∏è';
        document.getElementById('decLabel').textContent = 'INDEFERIDO';
        document.getElementById('decReason').textContent = 'Impedimento inferior a 2 anos ‚Äî requisito n√£o satisfeito';
        document.getElementById('decItem').textContent = 'Art. 20, ¬ß¬ß 2¬∫ e 10, Lei 8.742/93';
      } else {
        const yes = tabelaConclusiva(amb.q, ativ.q, corpo.q);
        dec.className = 'decision ' + (yes ? 'deferido' : 'indeferido');
        document.getElementById('decIcon').textContent = yes ? '‚úÖ' : '‚ùå';
        document.getElementById('decLabel').textContent = yes ? 'DEFERIDO' : 'INDEFERIDO';
        let reason = '';
        if (!yes) {
          if (corpo.q <= 1) reason = `Fun√ß√µes do Corpo = ${Q_LABELS[corpo.q]} (${Q_NAMES[corpo.q]}) ‚Äî exige-se ‚â• Moderada`;
          else if (ativ.q <= 1) reason = `Atividades e Participa√ß√£o = ${Q_LABELS[ativ.q]} (${Q_NAMES[ativ.q]}) ‚Äî exige-se ‚â• Moderada`;
          else reason = `Combina√ß√£o M-M com Ambiente ${Q_LABELS[amb.q]} ‚Äî exige-se Ambiente ‚â• Grave`;
        } else {
          if (corpo.q >= 3 && ativ.q >= 2) reason = `Fun√ß√µes ${Q_LABELS[corpo.q]} + Atividades ${Q_LABELS[ativ.q]} ‚Äî deferimento independente do Ambiente`;
          else if (ativ.q >= 3 && corpo.q >= 2) reason = `Atividades ${Q_LABELS[ativ.q]} + Fun√ß√µes ${Q_LABELS[corpo.q]} ‚Äî deferimento independente do Ambiente`;
          else reason = `Corpo M + Atividades M + Ambiente ${Q_LABELS[amb.q]} (‚â• G) ‚Äî combina√ß√£o deferida`;
        }
        document.getElementById('decReason').textContent = reason;
        document.getElementById('decItem').textContent = `Item ${item} da Tabela Conclusiva`;
      }
      dec.classList.add('pop');
      setTimeout(() => dec.classList.remove('pop'), 300);

      // Comparison
      if (savedINSS) updateComparison(amb, ativ, corpo);
    }

    function setQBadge(id, q) {
      const el = document.getElementById(id);
      el.textContent = Q_LABELS[q]; el.dataset.q = Q_LABELS[q];
    }
    function highlightActiveCell(ativQ, corpoQ) {
      document.querySelectorAll('.tc.active-cell').forEach(c => c.classList.remove('active-cell'));
      document.querySelectorAll('.tc[data-c]').forEach(c => {
        if (+c.dataset.c === corpoQ && +c.dataset.a === ativQ) c.classList.add('active-cell');
      });
    }

    // ============ EVENT HANDLERS ============
    document.addEventListener('click', e => {
      const btn = e.target.closest('.note-btn');
      if (!btn || btn.classList.contains('locked')) return;
      const group = btn.parentElement;
      const domain = group.dataset.domain;
      const val = +btn.dataset.value;
      group.querySelectorAll('.note-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state[domain] = val;
      update();
    });

    document.getElementById('toggleProg').addEventListener('change', e => { progDesfav = e.target.checked; update() });
    document.getElementById('toggleEstr').addEventListener('change', e => { estrMaior = e.target.checked; update() });
    document.getElementById('toggleImpedimento').addEventListener('change', e => { impedimento = e.target.checked; update() });

    // Dark mode
    document.getElementById('toggleDark').addEventListener('change', e => {
      document.documentElement.dataset.theme = e.target.checked ? 'dark' : '';
    });

    // Children mode by age (<16 years)
    document.getElementById('inputIdade').addEventListener('input', e => {
      idadeMeses = Math.max(0, Math.min(216, +e.target.value || 0));
      e.target.value = idadeMeses;
      syncChildModeByAge();
      applyChildRules(); update();
    });
    function syncChildModeByAge() {
      crianca = idadeMeses < CHILD_AGE_LIMIT_MONTHS;
      const faixa = document.getElementById('faixaEtaria');
      faixa.textContent = crianca ? 'Menor de 16 anos' : '16 anos ou mais';
    }
    function applyChildRules() {
      [...DOM_ATIV_M, ...DOM_ATIV_S].forEach(d => {
        const btns = document.querySelectorAll(`[data-domain="${d.id}"] .note-btn`);
        if (crianca && idadeMeses < d.cut) {
          if (!(d.id in childDomainBackup)) childDomainBackup[d.id] = state[d.id];
          state[d.id] = 4;
          btns.forEach(b => {
            b.classList.toggle('active', +b.dataset.value === 4);
            b.classList.add('locked');
          });
        } else {
          if (d.id in childDomainBackup) {
            state[d.id] = childDomainBackup[d.id];
            delete childDomainBackup[d.id];
          }
          btns.forEach(b => {
            b.classList.remove('locked');
            b.classList.toggle('active', +b.dataset.value === state[d.id]);
          });
        }
      });
    }

    // Amb tabs
    document.querySelectorAll('.amb-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        currentAmbTab = +tab.dataset.a;
        document.querySelectorAll('.amb-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        buildTabelaGrid();
        const ativ = calcAtividades(), corpo = calcCorpo();
        highlightActiveCell(ativ.q, corpo.q);
      });
    });

    // Padr√£o M√©dio Social
    document.getElementById('btnPadrao').addEventListener('click', () => {
      const padrao = { e1: 2, e2: 2, e3: 2, e4: 1, e5: 2, d6: 3, d7: 2, d8: 3, d9: 3 };
      Object.entries(padrao).forEach(([id, v]) => {
        if (crianca) {
          const d = [...DOM_ATIV_M, ...DOM_ATIV_S].find(x => x.id === id);
          if (d && idadeMeses < d.cut) return;
        }
        state[id] = v;
        const btns = document.querySelectorAll(`[data-domain="${id}"] .note-btn`);
        btns.forEach(b => { b.classList.remove('active'); if (+b.dataset.value === v) b.classList.add('active') });
      });
      update();
    });

    // Clear
    document.getElementById('btnLimpar').addEventListener('click', () => {
      Object.keys(state).forEach(k => state[k] = 0);
      Object.keys(childDomainBackup).forEach(k => delete childDomainBackup[k]);
      progDesfav = false; estrMaior = false; impedimento = false;
      document.getElementById('toggleProg').checked = false;
      document.getElementById('toggleEstr').checked = false;
      document.getElementById('toggleImpedimento').checked = false;
      document.querySelectorAll('.note-btn').forEach(b => { b.classList.remove('active', 'locked'); if (+b.dataset.value === 0) b.classList.add('active') });
      applyChildRules();
      update();
    });

    // Save INSS
    document.getElementById('btnSaveINSS').addEventListener('click', () => {
      const amb = calcAmbiente(), ativ = calcAtividades(), corpo = calcCorpo();
      savedINSS = {
        amb: amb.q, ativ: ativ.q, corpo: corpo.q,
        result: impedimento ? false : tabelaConclusiva(amb.q, ativ.q, corpo.q),
        impedimento, item: getItemNumber(amb.q, ativ.q, corpo.q)
      };
      document.getElementById('compSection').classList.remove('hidden');
      document.getElementById('btnClearComp').classList.remove('hidden');
      updateComparison(amb, ativ, corpo);
    });
    document.getElementById('btnClearComp').addEventListener('click', () => {
      savedINSS = null;
      document.getElementById('compSection').classList.add('hidden');
      document.getElementById('btnClearComp').classList.add('hidden');
    });

    function updateComparison(amb, ativ, corpo) {
      if (!savedINSS) return;
      const s = savedINSS;
      document.getElementById('compINSSq').textContent = `Ambiente: ${Q_LABELS[s.amb]} ¬∑ Atividades: ${Q_LABELS[s.ativ]} ¬∑ Fun√ß√µes: ${Q_LABELS[s.corpo]}`;
      document.getElementById('compINSSr').textContent = s.result ? '‚úÖ DEFERIDO' : '‚ùå INDEFERIDO';
      document.getElementById('compINSSr').className = 'comp-result ' + (s.result ? 'yes' : 'no');
      const curResult = impedimento ? false : tabelaConclusiva(amb.q, ativ.q, corpo.q);
      document.getElementById('compPERq').textContent = `Ambiente: ${Q_LABELS[amb.q]} ¬∑ Atividades: ${Q_LABELS[ativ.q]} ¬∑ Fun√ß√µes: ${Q_LABELS[corpo.q]}`;
      document.getElementById('compPERr').textContent = curResult ? '‚úÖ DEFERIDO' : '‚ùå INDEFERIDO';
      document.getElementById('compPERr').className = 'comp-result ' + (curResult ? 'yes' : 'no');
      let changes = [];
      if (s.amb !== amb.q) changes.push(`Ambiente: ${Q_LABELS[s.amb]}‚Üí${Q_LABELS[amb.q]}`);
      if (s.ativ !== ativ.q) changes.push(`Atividades: ${Q_LABELS[s.ativ]}‚Üí${Q_LABELS[ativ.q]}`);
      if (s.corpo !== corpo.q) changes.push(`Fun√ß√µes: ${Q_LABELS[s.corpo]}‚Üí${Q_LABELS[corpo.q]}`);
      if (!s.result && curResult) changes.push('üîÑ Resultado REVERTIDO: Indeferido ‚Üí Deferido');
      else if (s.result && !curResult) changes.push('üîÑ Resultado REVERTIDO: Deferido ‚Üí Indeferido');
      document.getElementById('compChange').innerHTML = changes.length ? changes.join(' ¬∑ ') : 'Sem altera√ß√£o no resultado';
    }

    // ============ INIT ============
    buildDomainRows(document.getElementById('domAmb'), DOM_AMB);
    buildDomainRows(document.getElementById('domCorpo'), DOM_CORPO);
    buildDomainRows(document.getElementById('domAtivM'), DOM_ATIV_M);
    buildDomainRows(document.getElementById('domAtivS'), DOM_ATIV_S);
    syncChildModeByAge();
    applyChildRules();
    buildTabelaGrid();
    update();
  </script>
</body>

</html>
