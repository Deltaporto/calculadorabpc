<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxograma ‚Äî Controle Judicial BPC/LOAS</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Segoe UI', system-ui, Arial, sans-serif;
            background: #f0f4f8;
            color: #1e293b;
            padding: 2rem;
            min-height: 100vh;
        }

        .page-header {
            text-align: center;
            margin-bottom: 1.75rem;
            padding: 1.5rem 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            border-top: 4px solid #1d4ed8;
        }

        .page-header h1 {
            font-size: 1.55rem;
            color: #1e3a5f;
            font-weight: 700;
            margin-bottom: 0.4rem;
            letter-spacing: -0.01em;
        }

        .page-header p {
            color: #64748b;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .controls {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.6rem 1.4rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.15s, transform 0.1s;
            letter-spacing: 0.01em;
        }

        button:active { transform: scale(0.97); }

        .btn-download {
            background: #1d4ed8;
            color: white;
        }
        .btn-download:hover { background: #1e40af; }

        .btn-print {
            background: #475569;
            color: white;
        }
        .btn-print:hover { background: #334155; }

        .diagram-container {
            background: white;
            border-radius: 12px;
            padding: 2rem 1.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            overflow-x: auto;
            margin-bottom: 1.5rem;
        }

        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 200px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 800px) {
            .info-grid { grid-template-columns: 1fr; }
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }

        .card h3 {
            font-size: 0.8rem;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.07em;
        }

        .legend-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
        }

        .legend-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            font-size: 0.85rem;
            line-height: 1.45;
        }

        .legend-dot {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            flex-shrink: 0;
            margin-top: 2px;
            border: 2px solid transparent;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        th, td {
            padding: 0.55rem 0.75rem;
            border: 1px solid #e2e8f0;
            text-align: left;
            line-height: 1.45;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
            font-size: 0.8rem;
        }

        tr:nth-child(even) { background: #f8fafc; }

        .text-pos { color: #16a34a; font-weight: 700; }
        .text-neg { color: #dc2626; font-weight: 700; }

        .motivos-card {
            margin-bottom: 1.5rem;
        }

        .motivos-card td:first-child {
            width: 40px;
            text-align: center;
            font-weight: 700;
            color: #1e3a5f;
        }

        .footnote {
            font-size: 0.75rem;
            color: #64748b;
            margin-top: 0.75rem;
            line-height: 1.5;
        }

        footer {
            text-align: center;
            font-size: 0.78rem;
            color: #94a3b8;
            margin-top: 0.5rem;
            padding: 1rem 0;
        }

        @media print {
            button, .controls { display: none !important; }
            body { background: white; padding: 0.5rem; font-size: 12px; }
            .card, .diagram-container, .page-header {
                box-shadow: none;
                border: 1px solid #e2e8f0;
                border-radius: 6px;
            }
            .page-header { border-top: 4px solid #1d4ed8; }
            .info-grid { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="page-header">
    <h1>Fluxograma ‚Äî Controle Judicial ¬∑ BPC/LOAS</h1>
    <p>
        An√°lise da prova t√©cnica m√©dica para decis√£o judicial sobre<br>
        a necessidade de renova√ß√£o da avalia√ß√£o social pericial
    </p>
</div>

<div class="controls">
    <button class="btn-download" onclick="downloadSVG()">‚¨á Baixar SVG</button>
    <button class="btn-print" onclick="window.print()">üñ® Imprimir</button>
</div>

<div class="diagram-container">
    <div class="mermaid" id="flowchart">
flowchart TB
    START(["IN√çCIO"])

    ADMIN["‚ë† BASE ADMINISTRATIVA<br/>Inserir qualificadores: Amb ¬∑ Ativ ¬∑ Corpo<br/>Escala: N = Nenhuma ¬∑ L = Leve ¬∑ M = Moderada ¬∑ G = Grave ¬∑ C = Completa<br/>INSS reconheceu Estruturas do Corpo?<br/>INSS reconheceu Progn√≥stico desfavor√°vel?"]

    START --> ADMIN --> ILP

    ILP{"Per√≠cia reconhece<br/>Impedimento de<br/>Longo Prazo?"}

    ILP -- "N√ÉO" --> D1
    ILP -- "SIM" --> SEC2

    D1(["‚úÖ DISPENSA ‚Äî Motivo 1<br/>Sem Impedimento LP reconhecido,<br/>o requisito biopsicossocial<br/>n√£o est√° em discuss√£o"])

    SEC2["‚ë° PER√çCIA M√âDICA"]

    SEC2 --> CORPO_ALTERAR

    CORPO_ALTERAR{"Per√≠cia traz novos elementos<br/>sobre Fun√ß√µes do Corpo<br/>em rela√ß√£o √† avalia√ß√£o adm.?"}

    CORPO_ALTERAR -- "N√ÉO - Manter" --> CORPO_EQ
    CORPO_ALTERAR -- "SIM - Alterar" --> CORPO_MOTIVO

    CORPO_EQ["Corpo Judicial<br/>= Corpo Administrativo"]

    CORPO_MOTIVO["Motivo da altera√ß√£o do Corpo Judicial:<br/>¬∑ Estruturas n√£o reconhecidas ‚Üí Adm + 1 grau (m√°x C)<br/>¬∑ Progn√≥stico n√£o reconhecido ‚Üí Adm + 1 grau (m√°x C)<br/>¬∑ Dom√≠nio b1-b8 mais grave ‚Üí m√°x entre dom√≠nios<br/>¬∑ Rebaixamento por prova ‚Üí qualificador manual"]

    CORPO_EQ --> CORPO_NL
    CORPO_MOTIVO --> CORPO_NL

    CORPO_NL{"Corpo Judicial<br/>= N ou L?"}

    CORPO_NL -- "SIM" --> D2
    CORPO_NL -- "N√ÉO (M, G ou C)" --> ATIV_REQUALIF

    D2(["‚úÖ DISPENSA ‚Äî Motivo 2<br/>Com Corpo N ou L, requalificar Atividades<br/>n√£o altera o resultado da Tabela Conclusiva"])

    ATIV_REQUALIF{"Per√≠cia trouxe elementos para<br/>requalificar Atividades?"}

    ATIV_REQUALIF -- "N√ÉO" --> ATIV_EQ
    ATIV_REQUALIF -- "SIM" --> ATIV_MODO

    ATIV_EQ["Atividades Judicial<br/>= Atividades Administrativas"]

    ATIV_MODO["Modo de requalifica√ß√£o das Atividades:<br/>¬∑ Simples: qualificador direto + justificativa<br/>¬∑ Completo: dom√≠nios d1-d9 ‚Üí qualificador calculado"]

    ATIV_EQ --> SEC3
    ATIV_MODO --> SEC3

    SEC3["‚ë¢ TRIAGEM PROBAT√ìRIA<br/>Processamento autom√°tico"]

    SEC3 --> TESTE_A

    TESTE_A{"TESTE A<br/>Amb Adm. + Ativ Adm. + Corpo Judicial<br/>‚Üí Tabela Conclusiva<br/>Resultado POSITIVO?"}

    TESTE_A -- "SIM" --> D3
    TESTE_A -- "N√ÉO" --> TESTE_B

    D3(["‚úÖ DISPENSA ‚Äî Motivo 3<br/>Com dados adm. + Corpo judicial,<br/>o resultado j√° √© favor√°vel ao benefici√°rio"])

    TESTE_B{"TESTE B<br/>Amb Adm. + Ativ M√©dica + Corpo Judicial<br/>‚Üí Tabela Conclusiva<br/>Resultado POSITIVO?"}

    TESTE_B -- "SIM" --> D4
    TESTE_B -- "N√ÉO" --> ASN

    D4(["‚úÖ DISPENSA ‚Äî Motivo 4<br/>Com Atividades m√©dicas requalificadas<br/>+ Corpo judicial, resultado √© favor√°vel"])

    ASN(["‚ùå AVALIA√á√ÉO SOCIAL NECESS√ÅRIA<br/>A prova t√©cnica n√£o √© suficiente<br/>para dispensar a avalia√ß√£o social"])

    D1 --> TEXTO
    D2 --> TEXTO
    D3 --> TEXTO
    D4 --> TEXTO
    ASN --> TEXTO

    TEXTO["‚ë£ TEXTO DA DECIS√ÉO<br/>Gerado automaticamente pelo sistema"]

    classDef startNode fill:#e0e7ff,stroke:#6366f1,stroke-width:3px,color:#312e81,font-weight:bold
    classDef sectionNode fill:#e2e8f0,stroke:#64748b,stroke-width:2px,color:#0f172a,font-weight:bold
    classDef input fill:#dbeafe,stroke:#3b82f6,stroke-width:1.5px,color:#1e3a5f
    classDef decision fill:#fef9c3,stroke:#d97706,stroke-width:1.5px,color:#78350f
    classDef dispensa fill:#dcfce7,stroke:#16a34a,stroke-width:2px,color:#14532d,font-weight:bold
    classDef negativo fill:#fee2e2,stroke:#dc2626,stroke-width:2.5px,color:#7f1d1d,font-weight:bold
    classDef auto fill:#f1f5f9,stroke:#94a3b8,stroke-width:1.5px,color:#334155

    class START startNode
    class SEC2,SEC3 sectionNode
    class ADMIN,CORPO_EQ,CORPO_MOTIVO,ATIV_EQ,ATIV_MODO input
    class ILP,CORPO_ALTERAR,CORPO_NL,ATIV_REQUALIF,TESTE_A,TESTE_B decision
    class D1,D2,D3,D4 dispensa
    class ASN negativo
    class TEXTO auto
    </div>
</div>

<div class="info-grid">
    <div class="card">
        <h3>Legenda ‚Äî Tipos de N√≥s</h3>
        <ul class="legend-list">
            <li class="legend-item">
                <div class="legend-dot" style="background:#e0e7ff;border-color:#6366f1"></div>
                <span><strong>In√≠cio</strong> ‚Äî Ponto de entrada do fluxo</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#e2e8f0;border-color:#64748b"></div>
                <span><strong>Se√ß√£o</strong> ‚Äî Marcador de etapa principal do processo</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#dbeafe;border-color:#3b82f6"></div>
                <span><strong>Input / Informa√ß√£o</strong> ‚Äî Dados inseridos ou fixados pelo sistema</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#fef9c3;border-color:#d97706"></div>
                <span><strong>Decis√£o</strong> ‚Äî Ponto de bifurca√ß√£o do fluxo (losango)</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#dcfce7;border-color:#16a34a"></div>
                <span><strong>DISPENSA</strong> ‚Äî Avalia√ß√£o social n√£o necess√°ria</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#fee2e2;border-color:#dc2626"></div>
                <span><strong>AVALIA√á√ÉO SOCIAL NECESS√ÅRIA</strong> ‚Äî Prova t√©cnica insuficiente</span>
            </li>
            <li class="legend-item">
                <div class="legend-dot" style="background:#f1f5f9;border-color:#94a3b8"></div>
                <span><strong>Autom√°tico</strong> ‚Äî Processamento ou sa√≠da gerada pelo sistema</span>
            </li>
        </ul>
    </div>

    <div class="card">
        <h3>Tabela Conclusiva ‚Äî L√≥gica de Decis√£o</h3>
        <table>
            <thead>
                <tr>
                    <th>Condi√ß√£o verificada</th>
                    <th>Resultado</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Corpo ‚â§ L (Nenhuma ou Leve)</td>
                    <td class="text-neg">Negativo</td>
                </tr>
                <tr>
                    <td>Atividades ‚â§ L (Nenhuma ou Leve)</td>
                    <td class="text-neg">Negativo</td>
                </tr>
                <tr>
                    <td>Corpo ‚â• G (Grave ou Completa)</td>
                    <td class="text-pos">Positivo</td>
                </tr>
                <tr>
                    <td>Atividades ‚â• G (Grave ou Completa)</td>
                    <td class="text-pos">Positivo</td>
                </tr>
                <tr>
                    <td>Ambos = M (Moderada) <strong>e</strong> Ambiente ‚â• G</td>
                    <td class="text-pos">Positivo</td>
                </tr>
            </tbody>
        </table>
        <p class="footnote">
            * Condi√ß√µes avaliadas em ordem; a primeira verdadeira determina o resultado.<br>
            Escala crescente: N &lt; L &lt; M &lt; G &lt; C ¬∑ Amb = Ambiente ¬∑ Ativ = Atividades
        </p>
    </div>
</div>

<div class="card motivos-card">
    <h3>Motivos de Dispensa ‚Äî Detalhamento</h3>
    <table>
        <thead>
            <tr>
                <th>#</th>
                <th>Situa√ß√£o que gera a dispensa</th>
                <th>Por que a avalia√ß√£o social √© dispensada?</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>1</td>
                <td>Impedimento de LP n√£o reconhecido pela per√≠cia</td>
                <td>Sem impedimento de longo prazo, o requisito biopsicossocial do BPC n√£o est√° em discuss√£o ‚Äî a avalia√ß√£o social seria desnecess√°ria</td>
            </tr>
            <tr>
                <td>2</td>
                <td>Corpo Judicial = N ou L</td>
                <td>Com Corpo N ou L, o resultado da Tabela Conclusiva j√° seria Negativo independentemente do qualificador de Atividades ‚Äî n√£o h√° o que requalificar que mude o desfecho</td>
            </tr>
            <tr>
                <td>3</td>
                <td>Teste A positivo</td>
                <td>Com os dados administrativos (Amb + Ativ) acrescidos apenas do Corpo judicial, o resultado j√° √© favor√°vel ao benefici√°rio ‚Äî a avalia√ß√£o social confirmaria o benef√≠cio sem acrescentar nada decisivo</td>
            </tr>
            <tr>
                <td>4</td>
                <td>Teste B positivo</td>
                <td>Com as Atividades requalificadas pela per√≠cia m√©dica + Corpo judicial, o resultado √© favor√°vel ‚Äî a prova t√©cnica isolada √© suficiente para o deferimento judicial</td>
            </tr>
        </tbody>
    </table>
</div>

<footer>
    Calculadora BPC/LOAS ¬∑ Controle Judicial &nbsp;¬∑&nbsp; Gerado em <span id="dataAtual"></span>
</footer>

<script>
    // Data atual no rodap√©
    document.getElementById('dataAtual').textContent =
        new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });

    // Inicializa√ß√£o do Mermaid
    mermaid.initialize({
        startOnLoad: true,
        theme: 'default',
        flowchart: {
            useMaxWidth: false,
            htmlLabels: true,
            curve: 'linear',
            padding: 20
        },
        securityLevel: 'loose',
        fontFamily: 'Segoe UI, system-ui, Arial, sans-serif',
        fontSize: 13
    });

    // Download SVG
    async function downloadSVG() {
        // Garante que o Mermaid terminou de renderizar
        await new Promise(r => setTimeout(r, 400));

        const svgEl = document.querySelector('#flowchart svg');
        if (!svgEl) {
            alert('O diagrama ainda n√£o foi renderizado. Aguarde e tente novamente.');
            return;
        }

        const clone = svgEl.cloneNode(true);
        clone.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
        clone.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');

        // Fundo branco expl√≠cito
        const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        bg.setAttribute('x', '0');
        bg.setAttribute('y', '0');
        bg.setAttribute('width', clone.getAttribute('width') || '100%');
        bg.setAttribute('height', clone.getAttribute('height') || '100%');
        bg.setAttribute('fill', 'white');
        clone.insertBefore(bg, clone.firstChild);

        const svgStr = new XMLSerializer().serializeToString(clone);
        const blob = new Blob([svgStr], { type: 'image/svg+xml;charset=utf-8' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = 'fluxograma-controle-judicial-bpc.svg';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>
